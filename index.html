<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart-Info | Fun & Scheduler</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary: #4472C4;
            --secondary: #2c4a85;
            --bg: #F0F2F5;
            --card-bg: #FFFFFF;
            --text: #333;
            --off-day: #FF9999;
            --off-text: #9C0006;
            --danger: #dc3545;
            --success: #28a745;
            --fun-color: #FF9F43;
            --purple: #8e44ad;
            --sound-btn: #00cec9;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; transition: all 0.3s ease; }
        body { background-color: var(--bg); color: var(--text); display: flex; min-height: 100vh; overflow-x: hidden; }

        /* Sidebar */
        .sidebar {
            width: 250px; background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
            color: white; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed; height: 100%; right: 0; z-index: 1000;
            transition: transform 0.3s ease-in-out;
        }
        .logo { font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .nav-item { padding: 15px; margin-bottom: 10px; cursor: pointer; border-radius: 10px; display: flex; align-items: center; gap: 10px; font-size: 16px; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.2); transform: translateX(-5px); }
        .nav-item.fun-mode.active { background: var(--fun-color); color: white; }

        .main-content { margin-right: 250px; width: calc(100% - 250px); padding: 30px; transition: all 0.3s ease; }

        /* Mobile */
        .menu-toggle { display: none; }
        .overlay { display: none; }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(100%); right: 0; } 
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-right: 0; width: 100%; padding: 15px; padding-top: 60px; }
            .menu-toggle { display: block; position: fixed; top: 15px; right: 15px; z-index: 1100; background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-size: 20px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
            .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 900; display: none; }
            .overlay.active { display: block; }
            table { font-size: 12px; }
            th, td { padding: 8px 5px; }
        }

        /* UI Elements */
        .header-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 10px; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-main:hover { background: var(--secondary); transform: translateY(-2px); }
        .btn-success { background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-decoration: none; display: inline-block;}
        .btn-nav { background: white; color: var(--primary); border: 1px solid var(--primary); padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 0 5px; font-weight: bold; font-size: 14px; }

        /* Team Grid */
        .team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .employee-card { background: var(--card-bg); border-radius: 15px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
        .avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); margin-bottom: 15px; cursor: pointer;}
        .card-actions { position: absolute; top: 10px; left: 10px; display: flex; gap: 5px; }
        .action-btn { width: 30px; height: 30px; border-radius: 50%; border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .btn-del { background: rgba(220, 53, 69, 0.8); } .btn-edit { background: rgba(68, 114, 196, 0.8); }

        /* Schedule Table */
        .schedule-container { background: white; padding: 20px; border-radius: 15px; overflow-x: auto; display: none; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px 10px; text-align: center; border-bottom: 1px solid #eee; white-space: nowrap; }
        th { background-color: var(--primary); color: white; }
        .off-cell { background-color: var(--off-day); color: var(--off-text); font-weight: bold; border-radius: 5px; }

        /* Forms */
        .form-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); max-width: 600px; margin: 0 auto; display: none; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: bold; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; }
        input[type="file"] { padding: 10px; background: #f8f9fa; }
        
        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 500px; max-width: 90%; text-align: center; }

        /* ========= FUN ZONE STYLES ========= */
        #fun-section { display: none; }
        .fun-header { text-align: center; background: linear-gradient(135deg, #FF9F43, #ff6b6b); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; }
        .fun-quote { font-size: 20px; font-weight: bold; margin-top: 10px; font-style: italic; min-height: 40px;}
        
        .sound-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 30px; }
        .sound-btn { background: white; border: 2px solid var(--sound-btn); color: var(--sound-btn); padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .sound-btn:active { transform: scale(0.95); background: var(--sound-btn); color: white; }

        .countdown-container { background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; text-align: center; border: 2px solid #ddd; }
        .countdown-timer { font-size: 32px; font-weight: bold; color: var(--purple); margin: 15px 0; direction: ltr; }
        
        .game-area { background: white; padding: 20px; border-radius: 15px; margin-top: 20px; display: none; text-align: center; min-height: 400px; animation: fadeIn 0.5s; }
        .fun-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .game-card { background: white; border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; border-bottom: 5px solid var(--fun-color); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .game-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .game-icon { font-size: 40px; color: var(--fun-color); margin-bottom: 10px; }

        /* Game Elements */
        canvas#wheel { width: 300px; height: 300px; margin: 20px auto; display: block; }
        .xo-board { display: grid; grid-template-columns: repeat(3, 80px); gap: 5px; margin: 20px auto; width: 250px; }
        .xo-cell { width: 80px; height: 80px; background: #eee; font-size: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; border-radius: 10px; color: var(--primary);}
        .xo-controls { margin-bottom: 15px; display: flex; gap: 10px; justify-content: center; }
        .memory-grid { display: grid; grid-template-columns: repeat(4, 60px); gap: 10px; margin: 20px auto; width: 270px; }
        .memory-card { width: 60px; height: 60px; background: var(--primary); border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; }
        .memory-card.flipped { background: white; border: 2px solid var(--primary); }
        .memory-card.matched { background: var(--success); cursor: default; }
        
        .scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .scenario-btn { background: white; border: 2px solid var(--purple); color: var(--purple); padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .scenario-btn:hover { background: var(--purple); color: white; transform: scale(1.05); }

        /* New Footer Style */
        .fun-footer { margin-top: 40px; padding: 20px; background: white; border-radius: 15px; text-align: center; border-top: 5px solid var(--purple); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .vote-buttons { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .btn-vote { padding: 10px 25px; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; color: white; }
        .btn-vote.yes { background: var(--success); }
        .btn-vote.no { background: var(--danger); }
        .btn-vote:hover { transform: scale(1.1); }
        .vote-result { font-size: 20px; font-weight: bold; margin-top: 10px; min-height: 30px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate { animation: fadeIn 0.5s ease forwards; }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    <div class="overlay" onclick="toggleSidebar()"></div>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-calendar-check"></i> Smart-Info</div>
        <div class="nav-item active" onclick="showSection('team'); toggleSidebarOnMobile();"><i class="fas fa-users"></i> ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„</div>
        <div class="nav-item" onclick="showSection('schedule'); toggleSidebarOnMobile();"><i class="fas fa-table"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´ÙØªØ§Øª</div>
        <div class="nav-item" onclick="showSection('add-emp'); toggleSidebarOnMobile();"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</div>
        <div class="nav-item fun-mode" onclick="showSection('fun'); toggleSidebarOnMobile();"><i class="fas fa-gamepad"></i> Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙØ±ÙØ´Ø©</div>
    </div>

    <div class="main-content">
        
        <div id="team-section" class="animate">
            <div class="header-section">
                <h2><i class="fas fa-users"></i> Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù€ Back Office</h2>
                <button class="btn-main" onclick="resetForm(); showSection('add-emp');">+ Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</button>
            </div>
            <div class="team-grid" id="teamGrid"></div>
        </div>

        <div id="add-emp-section" class="form-container animate">
            <h2 id="formTitle" style="text-align: center; margin-bottom: 20px; color: var(--primary);">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h2>
            <input type="hidden" id="editEmpId">
            <div class="input-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label><input type="text" id="empName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠ"></div>
            <div class="input-group"><label>Ø§Ù„Ù†ÙˆØ¹</label><select id="empGender"><option value="male">Ø°ÙƒØ±</option><option value="female">Ø£Ù†Ø«Ù‰</option></select></div>
            <div class="input-group"><label>ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ ÙŠÙˆÙ… Ø¹Ù…Ù„</label><input type="date" id="empStartDate"><small style="color: #777;">Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…Ø·.</small></div>
            <div class="input-group"><label>ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input type="file" id="empPhotoFile" accept="image/*"></div>
            <button class="btn-main" style="width: 100%" onclick="saveEmployee()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>

        <div id="schedule-section" class="schedule-container animate">
            <div class="header-section">
                <h2><i class="fas fa-calendar-alt"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´ÙØªØ§Øª</h2>
                <div><button class="btn-success" onclick="exportToRealExcel()"><i class="fas fa-file-excel"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Excel)</button></div>
            </div>
            <div style="display:flex; justify-content:center; align-items:center; margin-bottom:15px; gap:5px; flex-wrap: wrap;">
                <button class="btn-nav" onclick="changeWeek(-1)"><i class="fas fa-chevron-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <span id="currentWeekLabel" style="font-weight: bold; background: #e9ecef; padding: 5px 15px; border-radius: 20px; font-size: 13px;">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                <button class="btn-nav" onclick="changeWeek(1)">Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-chevron-left"></i></button>
            </div>
            <div style="overflow-x: auto;">
                <table id="scheduleTable"><thead id="tableHead"></thead><tbody id="tableBody"></tbody></table>
            </div>
        </div>

        <div id="fun-section" class="animate">
            <div class="fun-header">
                <h2>ğŸ˜‚ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
                <p style="margin-bottom:5px; font-size:12px; color:rgba(255,255,255,0.8)">Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© Ø®Ø§ØµØ© Ø¨ÙŠÙƒ Ù„ÙˆØ­Ø¯Ùƒ ğŸ˜‰</p>
                <div id="dailyQuote" class="fun-quote">Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø¹Ø´Ø§Ù† ØªØ´ÙˆÙ Ø±Ø³Ø§Ù„ØªÙƒ</div>
                <select id="msgSelector" onchange="showPersonalMessage()" style="padding:5px; border-radius:5px; margin-top:10px;">
                    <option value="">-- Ù…ÙŠÙ† Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙ‚Ø±Ø§ØŸ --</option>
                </select>
            </div>

            <h3 style="color: var(--sound-btn); margin-bottom: 15px;">ğŸ”Š Ø³Ø§ÙˆÙ†Ø¯ Ø¨ÙˆØ±Ø¯ Ø§Ù„Ù…ÙƒØªØ¨</h3>
            <div class="sound-grid">
                <button class="sound-btn" onclick="playSound('https://www.soundjay.com/human/sounds/applause-01.mp3')"><i class="fas fa-hands-clapping"></i> ØªØ³Ù‚ÙŠÙ</button>
                <button class="sound-btn" onclick="playSound('https://www.myinstants.com/media/sounds/cricket-sound.mp3')"><i class="fas fa-bug"></i> ØµØ±ØµÙˆØ±</button>
                <button class="sound-btn" onclick="playSound('https://www.myinstants.com/media/sounds/ba-dum-tss.mp3')"><i class="fas fa-drum"></i> Ù†ÙƒØªØ©</button>
                <button class="sound-btn" onclick="playSound('https://www.myinstants.com/media/sounds/fail-sound-effect.mp3')"><i class="fas fa-times-circle"></i> ØºÙ„Ø·</button>
                <button class="sound-btn" onclick="playSound('https://www.myinstants.com/media/sounds/ka-ching.mp3')"><i class="fas fa-money-bill-wave"></i> ÙÙ„ÙˆØ³</button>
                <button class="sound-btn" onclick="playSound('https://www.myinstants.com/media/sounds/evil-laugh.mp3')"><i class="fas fa-ghost"></i> Ø¶Ø­ÙƒØ© Ø´Ø±ÙŠØ±Ø©</button>
            </div>

            <div class="countdown-container">
                <h3 style="color: #333;"><i class="fas fa-hourglass-half"></i> ÙØ§Ø¶Ù„ Ù‚Ø¯ Ø¥ÙŠÙ‡ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø²ØªÙƒØŸ</h3>
                <p>Ø¨Ù†Ø­Ø³Ø¨Ù„Ùƒ Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø£ÙˆÙ„ ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø© Ø¬Ø§ÙŠ Ù„ÙŠÙƒ:</p>
                <select id="countdownSelect" onchange="startPersonalCountdown()" style="padding: 10px; border-radius: 5px; width: 200px; margin-bottom: 10px;"></select>
                <div id="countdownDisplay">
                    <div class="countdown-msg">Ø§Ø®ØªØ§Ø± Ø§Ø³Ù…Ùƒ ÙŠØ§ Ø¨Ø·Ù„...</div>
                </div>
            </div>

            <h3 style="color: var(--purple); margin-bottom: 15px;">ğŸ¤” ÙÙ‚Ø±Ø© "Ù…ÙŠÙ† Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¯ÙˆØ±ØŸ"</h3>
            <div class="scenario-grid">
                <button class="scenario-btn" onclick="playScenario('Ø­Ù„ÙˆÙŠØ§Øª')"><i class="fas fa-birthday-cake"></i> Ù…ÙŠÙ† Ù‡ÙŠØ¬ÙŠØ¨ Ø­Ù„ÙˆÙŠØ§Øª Ø¨ÙƒØ±Ø©ØŸ</button>
                <button class="scenario-btn" onclick="playScenario('ÙØ·Ø§Ø±')"><i class="fas fa-utensils"></i> Ù…ÙŠÙ† Ø¹Ù„ÙŠÙ‡ Ø§Ù„ÙØ·Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©ØŸ</button>
                <button class="scenario-btn" onclick="playScenario('ÙØ±ÙØ´Ø©')"><i class="fas fa-smile-wink"></i> Ù…ÙŠÙ† Ø£ÙƒØªØ± ÙˆØ§Ø­Ø¯ Ø¨ÙŠÙØ±ÙØ´ Ø§Ù„ØªÙŠÙ…ØŸ</button>
                <button class="scenario-btn" onclick="playScenario('Ø§Ø¬Ø§Ø²Ø©')"><i class="fas fa-plane-departure"></i> Ù…ÙŠÙ† Ù…Ø­ØªØ§Ø¬ Ø¥Ø¬Ø§Ø²Ø© Ø¯Ù„ÙˆÙ‚ØªÙŠ Ø­Ø§Ù„Ø§ØŸ</button>
            </div>

            <h3 style="color: var(--fun-color); margin-bottom: 15px;">ğŸ® Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h3>
            <div class="fun-grid">
                <div class="game-card" onclick="startGame('wheel')"><div class="game-icon"><i class="fas fa-bullseye"></i></div><h3>Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ (ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…)</h3></div>
                <div class="game-card" onclick="startGame('xo')"><div class="game-icon"><i class="fas fa-times"></i></div><h3>X - O (ØªØ­Ø¯ÙŠ)</h3></div>
                <div class="game-card" onclick="startGame('memory')"><div class="game-icon"><i class="fas fa-brain"></i></div><h3>Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø³Ù…ÙƒØ©</h3></div>
            </div>

            <div id="game-wheel" class="game-area">
                <h3 style="color:var(--fun-color)">ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</h3>
                <canvas id="wheel" width="300" height="300"></canvas>
                <button class="btn-main" onclick="spinWheel()" style="background:var(--fun-color)">Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø©!</button>
                <p id="wheelResult" style="margin-top:15px; font-weight:bold; font-size:18px;"></p>
            </div>

            <div id="game-xo" class="game-area">
                <h3 style="color:var(--primary)">âŒ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ â­•</h3>
                <div class="xo-controls">
                    <select id="playerX"></select>
                    <span>Ø¶Ø¯</span>
                    <select id="playerO"></select>
                </div>
                <div id="xoBoard" class="xo-board"></div>
                <p id="xoStatus">Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ø¨Ø¯Ø£ÙˆØ§!</p>
                <button class="btn-nav" onclick="initXO()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>

            <div id="game-memory" class="game-area">
                <h3 style="color:var(--success)">ğŸ§  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°Ø§ÙƒØ±Ø©</h3>
                <div id="memoryBoard" class="memory-grid"></div>
                <p id="memoryStatus">Ø­Ø§ÙˆÙ„ ØªÙ„Ø§Ù‚ÙŠ Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡ÙŠÙ†!</p>
                <button class="btn-nav" onclick="initMemory()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
            </div>

            <div class="fun-footer">
                <h3>Ø­Ø§ÙˆÙ„Øª Ø§Ø¹Ù…Ù„ Ø­Ø§Ø¬Ø© ØµØ­ ğŸ«¡</h3>
                <p>ØªØ­Ø¨ÙˆØ§ Ù†Ø²ÙˆØ¯ Ø§Ù„Ø¹Ø§Ø¨ Ø§ÙƒØªØ± ØŸØŸ</p>
                <div class="vote-buttons">
                    <button class="btn-vote yes" onclick="vote('yes')">Ø§Ù‡ ğŸ˜</button>
                    <button class="btn-vote no" onclick="vote('no')">Ù„Ø§ ğŸ˜’</button>
                </div>
                <div id="voteResult" class="vote-result"></div>
            </div>

        </div>

    </div>

    <div id="empModal" class="modal">
        <div class="modal-content">
            <img id="modalImg" src="" class="avatar">
            <h2 id="modalName" style="color: var(--primary);"></h2>
            <p style="color: gray;">Back Office Agent</p>
            <div style="background: #f9f9f9; padding: 15px; margin-top: 20px; border-radius: 10px; text-align: right;">
                <h4>Ø§Ù„Ø£Ø¬Ø§Ø²Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</h4>
                <p id="modalBreak" style="color: var(--secondary); font-weight: bold;"></p>
            </div>
            <button class="btn-main" style="margin-top: 20px; background: #555;" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="scenarioModal" class="modal">
        <div class="modal-content" style="background: linear-gradient(135deg, #8e44ad, #3498db); color: white;">
            <h2 id="scenarioTitle">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±...</h2>
            <div id="scenarioName" style="font-size: 40px; font-weight: bold; margin: 30px 0; height: 60px;">...</div>
            <button class="btn-main" style="background: white; color: #333;" onclick="document.getElementById('scenarioModal').style.display='none'">ØªÙ…Ø§Ù…</button>
        </div>
    </div>

    <div id="dareModal" class="modal">
        <div class="modal-content" style="background: #FF9F43; color: white;">
            <h2>ğŸ˜ˆ Ø§Ù„Ø­ÙƒÙ… Ø·Ù„Ø¹ Ø¹Ù„ÙŠÙƒ ÙŠØ§ <span id="dareVictim"></span>!</h2>
            <hr style="border-color: rgba(255,255,255,0.3); margin: 15px 0;">
            <p id="dareText" style="font-size: 22px; font-weight: bold; line-height: 1.5;"></p>
            <button class="btn-main" style="margin-top: 20px; background: white; color: #333;" onclick="document.getElementById('dareModal').style.display='none'">Ù‡Ù†ÙØ° ÙˆØ£Ù…Ø±ÙŠ Ù„Ù„Ù‡</button>
        </div>
    </div>

    <div id="winModal" class="modal">
        <div class="modal-content" style="background: #28a745; color: white;">
            <h2>ğŸ† Ù…Ø¨Ø±ÙˆÙˆÙˆÙƒ ÙŠØ§ <span id="winnerName"></span>!</h2>
            <p style="font-size: 20px; margin-top: 20px;">Ø£ÙˆÙ„ Ù…Ø±Ø© ØªÙƒØ³Ø¨ Ø­Ø§Ø¬Ø© ÙÙŠ Ø­ÙŠØ§ØªÙƒ Ø¨Ø§ÙŠÙ† ğŸ˜‚</p>
            <button class="btn-main" style="margin-top: 20px; background: white; color: #333;" onclick="document.getElementById('winModal').style.display='none'">Ø®Ù„Ø§Øµ Ø¹Ø±ÙÙ†Ø§</button>
        </div>
    </div>

    <script>
        // === 1. Core Logic & Data Restoration ===
        const BASE_DATE = new Date('2026-01-10T00:00:00'); 
        let currentWeekOffset = 0; 
        
        // This ensures the team is NEVER empty on first load
        const employeesDefault = [
            { id: 6, name: 'ÙƒØ±ÙŠÙ…', gender: 'male', photo: '', baseOffset: 0 },
            { id: 3, name: 'Ù‡Ù†Ø§', gender: 'female', photo: '', baseOffset: -1 },
            { id: 4, name: 'Ù†Ø¯Ù‰', gender: 'female', photo: '', baseOffset: 1 },
            { id: 1, name: 'Ù†Ù‡Ù„Ø©', gender: 'female', photo: '', baseOffset: 3 },
            { id: 2, name: 'Ø³Ù„Ù…Ù‰', gender: 'female', photo: '', baseOffset: 4 },
            { id: 5, name: 'Ø´Ù‡Ø¯', gender: 'female', photo: '', baseOffset: 5 }
        ];
        
        // Check if storage is empty, if so, use default
        let storedData = localStorage.getItem('smartEmployeesFinalV2');
        let employees = (storedData && storedData !== "[]") ? JSON.parse(storedData) : employeesDefault;

        // Force save immediately to fix any "empty list" issues
        if(!storedData || storedData === "[]") {
            localStorage.setItem('smartEmployeesFinalV2', JSON.stringify(employees));
        }

        const maleAvatar = "https://cdn-icons-png.flaticon.com/512/4128/4128176.png";
        const femaleAvatar = "https://cdn-icons-png.flaticon.com/512/4140/4140047.png";

        function toggleSidebar() { document.querySelector('.sidebar').classList.toggle('active'); document.querySelector('.overlay').classList.toggle('active'); }
        function toggleSidebarOnMobile() { if (window.innerWidth <= 768) { toggleSidebar(); } }
        
        function showSection(id) {
            document.querySelectorAll('.main-content > div').forEach(div => div.style.display = 'none');
            document.getElementById(id + '-section').style.display = 'block';
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if(id === 'team') document.querySelectorAll('.nav-item')[0].classList.add('active');
            if(id === 'schedule') { document.querySelectorAll('.nav-item')[1].classList.add('active'); renderSchedule(); }
            if(id === 'add-emp') document.querySelectorAll('.nav-item')[2].classList.add('active');
            if(id === 'fun') { 
                document.querySelectorAll('.nav-item')[3].classList.add('active'); 
                prepareFunZone();
            }
        }

        // === 2. FUN ZONE LOGIC ===
        
        function prepareFunZone() {
            // Fill Selectors
            const selects = [document.getElementById('msgSelector'), document.getElementById('countdownSelect'), document.getElementById('playerX'), document.getElementById('playerO')];
            selects.forEach(s => {
                const currentVal = s.value;
                s.innerHTML = '<option value="">-- Ø§Ø®ØªØ§Ø± Ø§Ù„Ø§Ø³Ù… --</option>';
                employees.forEach(emp => {
                    const opt = document.createElement('option');
                    opt.value = emp.id;
                    opt.innerText = emp.name;
                    s.appendChild(opt);
                });
                if(currentVal) s.value = currentVal;
            });
        }

        // --- Daily Message (Gender Aware) ---
        const messagesDB = {
            male: [
                "ØµØ¨Ø§Ø­Ùƒ Ø²ÙŠ Ø§Ù„ÙÙ„ØŒ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© ÙŠÙˆÙ…Ùƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸ’ª",
                "ÙŠØ§ ÙˆØ§Ø¯ ÙŠØ§ Ø¬Ø§Ù…Ø¯ØŒ Ø§Ù„ØªÙŠÙ… Ù…Ù† ØºÙŠØ±Ùƒ ÙˆÙ„Ø§ Ø­Ø§Ø¬Ø©",
                "Ø£Ù†Øª Ø§Ù„Ø¨Ø±Ù†Ø³ Ø¨ØªØ§Ø¹Ù†Ø§ØŒ Ù…ØªØ²Ø¹Ù„Ø´ Ù†ÙØ³Ùƒ Ù…Ù† Ø£ÙŠ Ø­Ø§Ø¬Ø©",
                "Ø±ÙƒØ² ÙÙŠ Ø§Ù„ØªØ§Ø³ÙƒØ§Øª Ø¨Ø³ Ù…ØªÙ†Ø³Ø§Ø´ Ø§Ù„ÙØ·Ø§Ø± ÙŠØ§ ÙˆØ­Ø´",
                "ÙŠØ§ Ø¨Ø®Øª Ø§Ù„Ù…ÙƒØªØ¨ Ø¨ÙŠÙƒ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©"
            ],
            female: [
                "ØµØ¨Ø§Ø­Ùƒ Ø²ÙŠ Ø§Ù„ÙÙ„ØŒ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© ÙŠÙˆÙ…Ùƒ ÙŠØ§ Ø§Ø³ØªØ§Ø§Ø§Ø§Ø§Ø°Ù‡ ! ğŸŒ¸",
                "ÙŠØ§ Ø³Øª Ø§Ù„ÙƒÙ„ØŒ Ø§Ù„ØªÙŠÙ… Ù…Ù† ØºÙŠØ±Ùƒ ÙˆÙ„Ø§ Ø­Ø§Ø¬Ø©",
                "Ø£Ù†ØªÙŠ Ø§Ù„Ø¨Ø±Ù†Ø³ÙŠØ³Ø© Ø¨ØªØ§Ø¹ØªÙ†Ø§ØŒ Ù…ØªØ²Ø¹Ù„ÙŠØ´ Ù†ÙØ³Ùƒ Ù…Ù† Ø£ÙŠ Ø­Ø§Ø¬Ø©",
                "Ø±ÙƒØ²ÙŠ ÙÙŠ Ø§Ù„ØªØ§Ø³ÙƒØ§Øª Ø¨Ø³ Ù…ØªÙ†Ø³ÙŠØ´ Ø§Ù„ÙØ·Ø§Ø± ÙŠØ§ Ù‚Ù…Ø±",
                "ÙŠØ§ Ø¨Ø®Øª Ø§Ù„Ù…ÙƒØªØ¨ Ø¨ÙŠÙƒÙŠ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©",
                "Ù…Ø´ Ø¹Ø§Ø±Ù Ù…Ù† ØºÙŠØ±Ùƒ Ù‡ÙŠØ¹Ù…Ù„ÙˆØ§ Ø§ÙŠ "
            ]
        };

        function showPersonalMessage() {
            const empId = document.getElementById('msgSelector').value;
            const display = document.getElementById('dailyQuote');
            if(!empId) { display.innerText = "Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø¹Ø´Ø§Ù† ØªØ´ÙˆÙ Ø±Ø³Ø§Ù„ØªÙƒ"; return; }
            
            const emp = employees.find(e => e.id == empId);
            const msgList = (emp.gender === 'male') ? messagesDB.male : messagesDB.female;
            
            // Generate unique index based on Date + Emp ID
            const today = new Date().toDateString();
            const seed = emp.id + today;
            let hash = 0;
            for (let i = 0; i < seed.length; i++) hash = seed.charCodeAt(i) + ((hash << 5) - hash);
            const index = Math.abs(hash) % msgList.length;
            
            display.innerText = `ÙŠØ§ ${emp.name}.. ${msgList[index]}`;
        }

        // --- Sound ---
        function playSound(url) { new Audio(url).play(); }

        // --- Real Countdown Logic (Fix) ---
        let countdownInterval;
        function startPersonalCountdown() {
            const empId = document.getElementById('countdownSelect').value;
            const display = document.getElementById('countdownDisplay');
            if(countdownInterval) clearInterval(countdownInterval);
            if(!empId) return;

            const emp = employees.find(e => e.id == empId);
            
            const update = () => {
                const now = new Date();
                
                // Logic: Find next off day based on 8-day cycle relative to BASE_DATE
                // Check TODAY first
                let targetDate = new Date(now);
                targetDate.setHours(0,0,0,0);
                
                let found = false;
                let daysAdded = 0;
                
                // Check if today is OFF
                const timeDiffNow = targetDate - BASE_DATE;
                const dayIndexNow = Math.floor(timeDiffNow / (1000 * 60 * 60 * 24));
                
                if(isDayOff(emp.baseOffset, dayIndexNow)) {
                     display.innerHTML = `<div class="countdown-msg" style="color:var(--success); font-weight:bold; font-size:20px;">ğŸ‰ Ø¥Ù†Øª Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©!</div><div class="countdown-msg">Ø§Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ³ØªÙ… ÙˆØ±ÙˆØ­ Ù†Ø§Ù…</div>`;
                     return;
                }

                // If not off today, find NEXT date
                while(!found && daysAdded < 50) {
                    targetDate.setDate(targetDate.getDate() + 1);
                    const timeDiff = targetDate - BASE_DATE;
                    const dayIndex = Math.floor(timeDiff / (1000 * 60 * 60 * 24)); 
                    
                    if(isDayOff(emp.baseOffset, dayIndex)) {
                        found = true;
                    }
                    daysAdded++;
                }

                const diff = targetDate - now;
                const d = Math.ceil(diff / (1000 * 60 * 60 * 24)); // Days only logic as requested
                
                display.innerHTML = `<div class="countdown-timer">${d} Ø£ÙŠØ§Ù…</div><div class="countdown-msg">Ù‡Ø§Ù†Øª.. Ø¥Ø¬Ø§Ø²ØªÙƒ ÙŠÙˆÙ… ${targetDate.toLocaleDateString('ar-EG', {weekday:'long'})}</div>`;
            };
            update();
            countdownInterval = setInterval(update, 1000);
        }

        // --- Wheel with Dares ---
        const maleDares = [
            "Ø§Ù†Ø²Ù„ 10 Ø¶ØºØ· Ø¯Ù„ÙˆÙ‚ØªÙŠ Ø­Ø§Ù„Ø§ ğŸ’ª", "Ø§Ø¹Ù…Ù„ Ø´Ø§ÙŠ Ù„Ù„ØªÙŠÙ… ÙƒÙ„Ù‡ â˜•", "Ù‚ÙˆÙ„ Ù†ÙƒØªØ© ØªØ¶Ø­ÙƒÙ†Ø§ ÙƒÙ„Ù†Ø§ ğŸ˜‚", 
            "Ø±ÙˆØ­ Ù„Ø¹Ù… Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø¨ÙˆÙÙŠÙ‡ ÙˆÙ‚ÙˆÙ„Ù‡ 'Ø¨Ø­Ø¨Ùƒ' â¤ï¸", "Ø§Ù…Ø´ÙŠ Ù…Ø´ÙŠØ© Ø¹Ø³ÙƒØ±ÙŠØ© ÙÙŠ Ø§Ù„Ø·Ø±Ù‚Ø© Ø±Ø§ÙŠØ­ Ø¬Ø§ÙŠ ğŸ‘®â€â™‚ï¸", 
            "Ø§Ø¹Ù…Ù„ Ù†ÙØ³Ùƒ Ù…Ø¹Ù„Ù‚ ÙƒÙˆØ±Ø© ÙˆØ¹Ù„Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ­ØµÙ„ ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨ âš½", "Ø§Ù†Ø²Ù„ Ù‡Ø§Øª ÙƒÙŠØ³ Ø´ÙŠØ¨Ø³ÙŠ Ù„Ø£ÙŠ Ø­Ø¯ ÙŠØ®ØªØ§Ø±Ù‡ Ø§Ù„ØªÙŠÙ… ğŸŸ", 
            "Ù‚Ù„Ø¯ ØµÙˆØª Ø­Ø¯ Ù…Ø´Ù‡ÙˆØ± ÙˆØ§Ù„ØªÙŠÙ… ÙŠØ­Ø§ÙˆÙ„ ÙŠØ®Ù…Ù† Ù…ÙŠÙ† ğŸ¤", "Ø§Ø¨Ø¹Øª ÙÙˆÙŠØ³ Ù†ÙˆØª Ù„Ù…Ø¯ÙŠØ±Ùƒ Ù‚ÙˆÙ„Ù‡ 'Ù…Ø³Ø§Ø¡ Ø§Ù„ÙÙ„ ÙŠØ§ Ø±ÙŠØ³' ğŸ“±"
        ];

        const femaleDares = [
            "ØºÙ†ÙŠ Ø§ØºÙ†ÙŠØ© Ø¨ØµÙˆØª Ø¹Ø§Ù„ÙŠ ğŸ¤", "Ù‡Ø§ØªÙŠ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ù„Ù„ØªÙŠÙ… Ø¨ÙƒØ±Ø© ğŸ«", "Ø§Ø¹Ù…Ù„ÙŠ Ù‚Ù‡ÙˆØ© Ù„Ø£ÙŠ Ø­Ø¯ ÙŠØ®ØªØ§Ø±ÙˆÙ‡ â˜•", 
            "Ù‚ÙˆÙ„ÙŠ 3 ØµÙØ§Øª Ø­Ù„ÙˆØ© ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ‘”", "Ù‚ÙˆÙ„ÙŠ Ù…ÙˆÙ‚Ù Ù…Ù† Ù…ÙˆØ§Ù‚ÙÙƒ Ø§Ù„ØºØ±ÙŠØ¨Ø© Ù…Ø­Ø¯Ø´ ÙŠØ¹Ø±ÙÙ‡Ø§ Â ğŸ’ƒ", 
            "Ù‚ÙˆÙ„ÙŠ 5 Ù…Ø±Ø§Øª Ø¨Ø³Ø±Ø¹Ø© 'Ù‚Ù…ÙŠØµ Ù†ÙÙŠØ³Ø© Ù†Ø´Ù' ğŸ¤ª", "Ø§ØªÙƒÙ„Ù…ÙŠ Ø²ÙŠ Ø§Ù„Ø±ÙˆØ¨ÙˆØª Ù„Ù…Ø¯Ø© Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ† ÙƒØ§Ù…Ù„ÙŠÙ† ğŸ¤–", 
            "Ø§Ø¹Ù…Ù„ÙŠ Ù†ÙØ³Ùƒ Ù…Ø°ÙŠØ¹Ø© ÙˆØ§Ø¹Ù…Ù„ÙŠ Ù„Ù‚Ø§Ø¡ Ø³Ø±ÙŠØ¹ Ù…Ø¹ Ø§Ù„Ù„ÙŠ Ø¬Ù†Ø¨Ùƒ ğŸ¤", "Ø§Ø±Ø³Ù…ÙŠ Ø­Ø¯ Ù…Ù† Ø§Ù„ØªÙŠÙ… Ø¹Ù„Ù‰ ÙˆØ±Ù‚Ø© ÙˆØ§Ù„Ù†Ø§Ø³ ØªØ®Ù…Ù† Ù…ÙŠÙ† ğŸ¨"
        ];
        
        let wheelCtx, wheelArc, wheelAngle = 0, wheelSpinning = false;
        
        function startGame(game) {
            document.querySelectorAll('.game-area').forEach(el => el.style.display = 'none');
            document.getElementById('game-' + game).style.display = 'block';
            if(game === 'wheel') initWheel();
            if(game === 'xo') initXO();
            if(game === 'memory') initMemory();
        }

        function initWheel() {
            const c = document.getElementById('wheel'); if(!c.getContext) return; wheelCtx = c.getContext("2d");
            if(employees.length === 0) return;
            wheelArc = Math.PI * 2 / employees.length; drawWheel();
        }
        function drawWheel() {
            const c = document.getElementById('wheel'), cw = c.width/2, ch = c.height/2; wheelCtx.clearRect(0,0,300,300);
            employees.forEach((emp, i) => {
                const a = wheelAngle + i * wheelArc; wheelCtx.beginPath(); wheelCtx.arc(cw, ch, 140, a, a + wheelArc); wheelCtx.lineTo(cw, ch);
                wheelCtx.fillStyle = (i%2==0)?"#FF9F43":"#ff6b6b"; wheelCtx.fill();
                wheelCtx.save(); wheelCtx.translate(cw + Math.cos(a + wheelArc/2)*100, ch + Math.sin(a + wheelArc/2)*100);
                wheelCtx.rotate(a + wheelArc/2 + Math.PI/2); wheelCtx.fillStyle = "white"; wheelCtx.font = "bold 14px Cairo";
                wheelCtx.fillText(emp.name, -wheelCtx.measureText(emp.name).width/2, 0); wheelCtx.restore();
            });
            wheelCtx.fillStyle = "#333"; wheelCtx.beginPath(); wheelCtx.moveTo(cw-10, 20); wheelCtx.lineTo(cw+10, 20); wheelCtx.lineTo(cw, 45); wheelCtx.fill();
        }
        function spinWheel() {
            if(wheelSpinning || employees.length===0) return;
            wheelSpinning = true; let s = Math.random()*0.5+0.5;
            const anim = () => {
                wheelAngle += s; drawWheel(); s -= 0.01;
                if(s>0) requestAnimationFrame(anim);
                else {
                    wheelSpinning = false;
                    const winnerIndex = Math.floor(((2*Math.PI - (wheelAngle%(2*Math.PI)))/wheelArc))%employees.length;
                    const winner = employees[winnerIndex];
                    
                    // Pick Dare based on Gender
                    const dares = (winner.gender === 'male') ? maleDares : femaleDares;
                    const randomDare = dares[Math.floor(Math.random() * dares.length)];
                    
                    document.getElementById('dareVictim').innerText = winner.name;
                    document.getElementById('dareText').innerText = randomDare;
                    document.getElementById('dareModal').style.display = 'flex';
                    confetti();
                }
            };
            anim();
        }

        // --- Advanced XO ---
        let xoState=["","","","","","","","",""], xoPlayer="X", xoActive=true;
        function initXO() {
            xoState=["","","","","","","","",""]; xoPlayer="X"; xoActive=true; 
            document.getElementById('xoStatus').innerText="Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: X"; 
            renderXO();
        }
        function renderXO() { 
            const b = document.getElementById('xoBoard'); b.innerHTML=''; 
            xoState.forEach((c,i)=>{ const d=document.createElement('div'); d.className='xo-cell'; d.innerText=c; d.onclick=()=>clkXO(i); if(c==="X") d.style.color="#FF9F43"; if(c==="O") d.style.color="#4472C4"; b.appendChild(d); }); 
        }
        function clkXO(i) { 
            const pX = document.getElementById('playerX');
            const pO = document.getElementById('playerO');
            if(!pX.value || !pO.value) return alert("Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„!");
            
            if(xoState[i]!=="" || !xoActive) return; 
            xoState[i]=xoPlayer; renderXO(); chkXOWin(); 
            xoPlayer=xoPlayer==="X"?"O":"X"; 
            if(xoActive) document.getElementById('xoStatus').innerText="Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: "+xoPlayer; 
        }
        function chkXOWin() { 
            const w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]; 
            for(let i=0;i<w.length;i++){ 
                const [a,b,c]=w[i]; 
                if(xoState[a] && xoState[a]===xoState[b] && xoState[a]===xoState[c]) { 
                    const pXName = document.getElementById('playerX').options[document.getElementById('playerX').selectedIndex].text;
                    const pOName = document.getElementById('playerO').options[document.getElementById('playerO').selectedIndex].text;
                    const winnerName = (xoPlayer === "X") ? pXName : pOName;
                    
                    document.getElementById('winnerName').innerText = winnerName;
                    document.getElementById('winModal').style.display = 'flex';
                    xoActive=false; confetti(); return; 
                } 
            } 
            if(!xoState.includes("")) { document.getElementById('xoStatus').innerText="ØªØ¹Ø§Ø¯Ù„! ğŸ˜"; xoActive=false; } 
        }

        // --- Memory Game (Restored) ---
        const emojis = ["ğŸ•", "ğŸš€", "ğŸ±", "âš½", "ğŸ¦", "ğŸ¸", "ğŸ•", "ğŸš€", "ğŸ±", "âš½", "ğŸ¦", "ğŸ¸"]; let memCards=[], flpCards=[], pairs=0;
        function initMemory() { memCards = emojis.sort(() => 0.5 - Math.random()); flpCards = []; pairs = 0; const b = document.getElementById('memoryBoard'); b.innerHTML = ''; document.getElementById('memoryStatus').innerText = "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡ÙŠÙ†!"; memCards.forEach((e, i) => { const c = document.createElement('div'); c.className = 'memory-card'; c.onclick = () => flpCard(c, e); b.appendChild(c); }); }
        function flpCard(c, e) { if(c.classList.contains('flipped') || c.classList.contains('matched') || flpCards.length >= 2) return; c.classList.add('flipped'); c.innerText = e; flpCards.push({el: c, val: e}); if(flpCards.length === 2) setTimeout(chkMatch, 800); }
        function chkMatch() { const [c1, c2] = flpCards; if(c1.val === c2.val) { c1.el.classList.add('matched'); c2.el.classList.add('matched'); pairs++; if(pairs === 6) { document.getElementById('memoryStatus').innerText = "Ù…Ø¨Ø±ÙˆÙˆÙƒ!"; confetti(); } } else { c1.el.classList.remove('flipped'); c1.el.innerText = ""; c2.el.classList.remove('flipped'); c2.el.innerText = ""; } flpCards = []; }

        // --- Scenario Picker (Preserved) ---
        function playScenario(type) { if(employees.length === 0) return alert("Ø¶Ù Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø£ÙˆÙ„!"); const modal = document.getElementById('scenarioModal'); const title = document.getElementById('scenarioTitle'); const nameDisplay = document.getElementById('scenarioName'); modal.style.display = 'flex'; title.innerText = type === 'Ø­Ù„ÙˆÙŠØ§Øª' ? "ğŸ© Ù…ÙŠÙ† Ù‡ÙŠØ¬ÙŠØ¨ Ø­Ù„ÙˆÙŠØ§ØªØŸ" : type === 'ÙØ·Ø§Ø±' ? "ğŸ³ Ù…ÙŠÙ† Ø¹Ù„ÙŠÙ‡ Ø§Ù„ÙØ·Ø§Ø±ØŸ" : type === 'ÙØ±ÙØ´Ø©' ? "ğŸ¥³ Ù…ÙŠÙ† ÙˆØ²ÙŠØ± Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©ØŸ" : "âœˆï¸ Ù…ÙŠÙ† Ø¹Ø§ÙŠØ² Ø¥Ø¬Ø§Ø²Ø©ØŸ"; let counter = 0; let interval = setInterval(() => { const randomName = employees[Math.floor(Math.random() * employees.length)].name; nameDisplay.innerText = randomName; counter++; if(counter > 20) { clearInterval(interval); confetti({ zIndex: 3000 }); } }, 100); }

        // === Voting Logic (New) ===
        function vote(choice) {
            const res = document.getElementById('voteResult');
            if(choice === 'yes') {
                res.innerHTML = "Ù„Ù…Ø§ Ø§Ø¬ÙŠÙ„ÙƒÙˆØ§ Ø¨Ù‚Ø§ ğŸ˜‚";
                res.style.color = "var(--success)";
                confetti();
            } else {
                res.innerHTML = "ÙŠ ÙˆØ¬Ø¹ Ø§Ù„Ù‚Ù„Ø¨ ğŸ’”";
                res.style.color = "var(--danger)";
            }
        }

        // === Standard Functions ===
        function isDayOff(empBaseOffset, daysSinceBase) { const n = daysSinceBase - empBaseOffset; const m = 8; const rem = ((n % m) + m) % m; return rem === 0 || rem === 1; }
        
        function renderTeam() { 
            const grid = document.getElementById('teamGrid'); grid.innerHTML = ''; 
            employees.forEach(emp => { 
                let imgSrc = emp.photo || (emp.gender === 'male' ? maleAvatar : femaleAvatar); 
                grid.innerHTML += `<div class="employee-card"><div class="card-actions"><button class="action-btn btn-del" onclick="deleteEmployee(${emp.id})"><i class="fas fa-trash"></i></button><button class="action-btn btn-edit" onclick="editEmployee(${emp.id})"><i class="fas fa-pen"></i></button></div><img src="${imgSrc}" class="avatar" onclick="openEmpModal(${emp.id})"><div class="emp-name">${emp.name}</div><div class="emp-role">Back Office</div></div>`; 
            }); 
        }
        function resetForm() { document.getElementById('formTitle').innerText = "Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯"; document.getElementById('editEmpId').value = ""; document.getElementById('empName').value = ""; document.getElementById('empGender').value = "male"; document.getElementById('empStartDate').value = ""; document.getElementById('empPhotoFile').value = ""; }
        function editEmployee(id) { const emp = employees.find(e => e.id === id); if (!emp) return; resetForm(); document.getElementById('formTitle').innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù"; document.getElementById('editEmpId').value = emp.id; document.getElementById('empName').value = emp.name; document.getElementById('empGender').value = emp.gender; showSection('add-emp'); }
        function saveEmployee() { const id = document.getElementById('editEmpId').value; const name = document.getElementById('empName').value; const gender = document.getElementById('empGender').value; const startDateStr = document.getElementById('empStartDate').value; const fileInput = document.getElementById('empPhotoFile'); if (!name) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…"); const processSave = (photoData) => { if (id) { const idx = employees.findIndex(e => e.id == id); if (idx > -1) { employees[idx].name = name; employees[idx].gender = gender; if (photoData) employees[idx].photo = photoData; if (startDateStr) { const startObj = new Date(startDateStr); employees[idx].baseOffset = Math.ceil((startObj - BASE_DATE) / 86400000) + 5; } } alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); } else { if (!startDateStr) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡"); const startObj = new Date(startDateStr); employees.push({ id: Date.now(), name, gender, photo: photoData, baseOffset: Math.ceil((startObj - BASE_DATE) / 86400000) + 5 }); alert("ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©"); } saveData(); resetForm(); showSection('team'); renderTeam(); }; if (fileInput.files && fileInput.files[0]) { const reader = new FileReader(); reader.onload = e => processSave(e.target.result); reader.readAsDataURL(fileInput.files[0]); } else { processSave(''); } }
        function deleteEmployee(id) { if(confirm("Ø­Ø°ÙØŸ")) { employees = employees.filter(e => e.id !== id); saveData(); renderTeam(); renderSchedule(); } }
        function changeWeek(d) { currentWeekOffset += d; renderSchedule(); }
        function getScheduleDataForOffset(offset) { let weekStart = new Date(BASE_DATE); weekStart.setDate(weekStart.getDate() + (offset * 7)); let headers = [], rows = []; const dayNames = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"]; for(let i=0; i<7; i++) { let d = new Date(weekStart); d.setDate(d.getDate() + i); headers.push(`${dayNames[i]} ${d.toLocaleDateString('ar-EG', {day:'numeric', month:'numeric'})}`); } employees.forEach((emp, index) => { let rowData = { name: emp.name, cells: [] }; let weekStatus = [], workIndices = []; for(let i=0; i<7; i++) { let isOff = isDayOff(emp.baseOffset, (offset * 7) + i); weekStatus.push({ isOff: isOff, time: "" }); if(!isOff && i < 6) workIndices.push(i); } let isFridayOff = weekStatus[6].isOff; if(!isFridayOff) weekStatus[6].time = "13:00"; let pattern = [], isGroupA = (index % 2 === 0); if (!isFridayOff) { if(isGroupA) pattern = ["9:00", "9:00", "10:00", "10:00"]; else pattern = ["10:00", "10:00", "9:00", "9:00"]; while(pattern.length < workIndices.length) pattern.push("9:00"); } else { if(isGroupA) pattern = ["10:00", "10:00", "10:00", "9:00", "9:00"]; else pattern = ["9:00", "9:00", "10:00", "10:00", "10:00"]; while(pattern.length < workIndices.length) pattern.push("10:00"); } workIndices.forEach((dayIdx, i) => { if(pattern[i]) weekStatus[dayIdx].time = pattern[i]; }); weekStatus.forEach(d => rowData.cells.push({ text: d.isOff ? "Off" : d.time, isOff: d.isOff })); rows.push(rowData); }); return { weekStart, headers, rows }; }
        function renderSchedule() { const data = getScheduleDataForOffset(currentWeekOffset); const options = { month: 'long', day: 'numeric', year: 'numeric' }; let weekEnd = new Date(data.weekStart); weekEnd.setDate(weekEnd.getDate() + 6); document.getElementById('currentWeekLabel').innerText = `Ø£Ø³Ø¨ÙˆØ¹: ${data.weekStart.toLocaleDateString('ar-EG', options)} - ${weekEnd.toLocaleDateString('ar-EG', options)}`; let theadHtml = `<tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th>`; data.headers.forEach(h => theadHtml += `<th>${h}</th>`); theadHtml += `</tr>`; document.getElementById('tableHead').innerHTML = theadHtml; const tbody = document.getElementById('tableBody'); tbody.innerHTML = ''; data.rows.forEach(row => { let rowHtml = `<tr><td style="font-weight:bold; color:var(--secondary)">${row.name}</td>`; row.cells.forEach(cell => { rowHtml += cell.isOff ? `<td class="off-cell">Off</td>` : `<td>${cell.text}</td>`; }); rowHtml += `</tr>`; tbody.innerHTML += rowHtml; }); }
        function exportToRealExcel() { const nameMap = { 'ÙƒØ±ÙŠÙ…': 'Kareem', 'Ù‡Ù†Ø§': 'Hana', 'Ù†Ø¯Ù‰': 'Nada', 'Ù†Ù‡Ù„Ø©': 'Nahla', 'Ø³Ù„Ù…Ù‰': 'Salma', 'Ø´Ù‡Ø¯': 'Shahd' }; const engDays = ["Saturday", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]; let ws_data = []; ws_data.push(["Smart-Info Back Office Schedule"]); ws_data.push([]); for (let w = 0; w < 12; w++) { const data = getScheduleDataForOffset(w); const options = { month: 'long', day: 'numeric', year: 'numeric' }; let weekEnd = new Date(data.weekStart); weekEnd.setDate(weekEnd.getDate() + 6); let range = `${data.weekStart.toLocaleDateString('en-GB', options)} - ${weekEnd.toLocaleDateString('en-GB', options)}`; ws_data.push([`Week ${w + 1}: ${range}`]); let colHeaders = ["Employee"]; for(let i=0; i<7; i++) { let d = new Date(data.weekStart); d.setDate(d.getDate() + i); colHeaders.push(`${engDays[i]} (${d.getDate()}/${d.getMonth()+1})`); } ws_data.push(colHeaders); data.rows.forEach(row => { let engName = nameMap[row.name] || row.name; let rowData = [engName]; row.cells.forEach(cell => { rowData.push(cell.text); }); ws_data.push(rowData); }); ws_data.push([]); } var wb = XLSX.utils.book_new(); var ws = XLSX.utils.aoa_to_sheet(ws_data); var wscols = [ {wch:15}, {wch:12}, {wch:12}, {wch:12}, {wch:12}, {wch:12}, {wch:12}, {wch:12} ]; ws['!cols'] = wscols; XLSX.utils.book_append_sheet(wb, ws, "Schedule"); XLSX.writeFile(wb, "Smart_Schedule_Full.xlsx"); }
        function openEmpModal(id) { const emp = employees.find(e => e.id === id); document.getElementById('modalName').innerText = emp.name; document.getElementById('modalImg').src = emp.photo || (emp.gender === 'male'? maleAvatar: femaleAvatar); let breakNames = []; const dayNames = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"]; for(let i=0; i<7; i++) { if(isDayOff(emp.baseOffset, (currentWeekOffset * 7) + i)) breakNames.push(dayNames[i]); } document.getElementById('modalBreak').innerText = breakNames.join(" Ùˆ "); document.getElementById('empModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('empModal').style.display = 'none'; document.getElementById('scenarioModal').style.display = 'none'; document.getElementById('dareModal').style.display = 'none'; document.getElementById('winModal').style.display = 'none'; }
        function saveData() { localStorage.setItem('smartEmployeesFinalV2', JSON.stringify(employees)); }
        
        init();
        function init(){ renderTeam(); renderSchedule(); }
    </script>
</body>
</html>
